//http://www.cprover.org/wmm/esop13/esop13.pdf

volatile _Bool latch1 = 0, latch2 = 0;
volatile _Bool flag1 = 0, flag2 = 0;


void* worker_1(void* arg) 
{  
  while(!latch1) {} 

  for(;;) 
  { 
    
    latch1 = 0;
    if(flag1) 
    { 
      flag1 = 0;
      flag2 = 1;
      latch2 = 1;
    } 

    while(!latch1) {} 
  } 
}

void* worker_2(void* arg)
{
  while(!latch2) {} 

  for(;;)
  {
   
    latch2 = 0;
    
    if(flag2)
    {
      flag2 = 0;
      flag1 = 1;
      latch1 = 1;
    }

    while(!latch2) {}
  }
}


int main()
{
__CPROVER_ASYNC_1: worker_1(0);
__CPROVER_ASYNC_2: worker_2(0);
  return 0;
}


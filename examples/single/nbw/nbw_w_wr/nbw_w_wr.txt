#
# Hermann Kopetz and J. Reisinger. The non-blocking write protocol
# nbw: A solution to a real-time synchronisation problem. In IEEE Real-
# Time Systems Symposium’93, pages 131–137, 1993.
#
# Writer, Writer-Reader.
#
#
# Memory layout:
# 0 — buf
# 1 — CCF

# We have one writer, and one write-read thread

thread writer
initial w1
transition	w1	w2	read	ccf	1
transition	w2	w3	write	+ 1 ccf	1
transition	w3	w4	write	0	0
transition	w4	w5	write	+ 2 ccf	1
transition 	w5	w1	noop
end

thread writerreader
initial w1
transition	w1	w2	read	ccf	1
transition	w2	w3	write	+ 1 ccf	1
transition	w3	w4	write	0	0
transition	w4	r1	write	+ 2 ccf	1

transition	r1	r2	read	ccf_b	1
transition	r2	r3	read	value	0
transition	r3	r4	read	ccf_e	1
transition	r4	r1	check	|| != ccf_b ccf_e  == & ccf_b 1 1
transition	r4	r5	check	&& == ccf_b ccf_e  == & ccf_b 1 0
transition 	r5	w1	noop
end

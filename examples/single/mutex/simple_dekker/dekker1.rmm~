/* Dekker's lock with deadlock protection
#
# Dekker's mutex algorithm:
# http://en.wikipedia.org/wiki/Dekker's_algorithm
#
# 0: while (true) {
# 1:   flag[0] = true;
# 2:   if (flag[1] == true) {     
# 3:         flag[0] = false;
# 4:         goto 1;
# 5:   } 
# 6:   // critical section
# 7:   flag[0] = false;
# 8:  }


Problem here: prococess 0 enters 
 */

forbidden
  CS CS
data
  turn = * : [0:1]

process(1)
data
  flag = 0 : [0:1]
registers
  $r0 = * : [0:1]
text
  L0: write: flag[my] := 1;
  read: $r0 := flag[0];
  if $r0 = 1 then {
      write: flag[my] := 0;
      goto L0
  };
  CS: nop; 
  write: flag[my] := 0;
  goto L0

process(1)
data
  flag = 0 : [0:1]
registers
  $r0 = * : [0:1]
text
  L0: write: flag[my] := 1;
  read: $r0 := flag[0];
  if $r0 = 1 then {
      write: flag[my] := 0;
      goto L0
    }
  };
  CS: nop; 
  write: flag[my] := 0;
  goto L0



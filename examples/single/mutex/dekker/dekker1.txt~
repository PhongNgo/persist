#
# Dekker's mutex algorithm:
# http://en.wikipedia.org/wiki/Dekker's_algorithm
#
# 0: while (true) {
# 1:   flag[0] = true;
# 2:   if (flag[1] == true) {     
# 3:         flag[0] = false;
# 4:         goto 1;
# 5:   } 
# 6:   // critical section
# 7:   flag[0] = false;
# 8:  }
#
# Memory layout:
# 0 — flag[0]
# 1 — flag[1]

# Trencher = Persist = Musketeer = 2 

thread t0
initial q0

transition q0	q1	write	1	0
transition q1	q2	read	flag1	1
transition q2	q3	check	== flag1 1
transition q2	q4	check	== flag1 0
transition q3 	q0	write	0	0
transition q4	q0	write	0	0

end

# Thread t1 is symmetric.
thread t1
initial q0

transition q0	q1	write	1	1
transition q1	q2	read	flag0	0
transition q2	q3	check	== flag0 1
transition q2	q4	check	== flag0 0
transition q3 	q0	write	0	1
transition q4	q0	write	0	1

end

